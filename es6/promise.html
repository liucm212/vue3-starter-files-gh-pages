<!DOCTYPE html>
<html>
  <head>
    <title>Promise</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="images/favicon.ico" rel="shortcut icon" />
    <meta charset="UTF-8" />
    <script src="/javascripts/vendor.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/3.2.37/vue.global.js"></script>
  </head>
  <body class="bg-lighter">
    <div class="container main my-5">
      <div class="row">
        <main class="col post">
          <!-- ç« ç¯€æ¨™é¡Œ -->
          <div class="mb-4">
            <h1 class="mt-0 text-muted">Promise</h1>
            <small>æª”åï¼š<code>promise.html</code></small>
          </div>
          <!-- ğŸ”¥ğŸ”¥ç·´ç¿’é–‹å§‹ğŸ”¥ğŸ”¥ -->
          <!-- æœ¬ç« ç¯€é¡å¤–è¼‰å…¥çš„é ç«¯å¥—ä»¶ : axioså¥—ä»¶ -->
          <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
          <script>
            // #1 éåŒæ­¥çš„è§€å¿µ
            // function getData() {
            //   setTimeout(() => {
            //     console.log('... å·²å–å¾—é ç«¯è³‡æ–™')
            //   }, 0)
            // }
            // // // è«‹å•å–å¾—è³‡æ–™çš„é †åºç‚ºä½•
            // const component = {
            //   //ç”Ÿå‘½é€±æœŸï¼šinitåˆå§‹åŒ–æ™‚è¦åšçš„äº‹ã€‚
            //   init() {
            //     console.log(1)
            //     getData() //å› ç‚ºgetDataå…§æ˜¯setTimeoutå‡½å¼ï¼ŒåŸºæœ¬ä¸Šæœƒæ”¾åœ¨æœ€å¾Œé¢ã€‚
            //     console.log(2)
            //     // é †åºç‚ºï¼š1 2 '... å·²å–å¾—é ç«¯è³‡æ–™'
            //   },
            // }
            // component.init()

            // æ›´æ­£ç¢ºçš„èªªæ³•ï¼ŒPromise æ˜¯ç‚ºäº†è§£æ±ºå‚³çµ±éåŒæ­¥èªæ³•é›£ä»¥å»ºæ§‹åŠç®¡ç†çš„å•é¡Œï¼Œå¦‚æœ‰èˆˆè¶£å¯æœå°‹ "callback hell js"

            // #2 Promise
            // åœ¨æ­¤ä¸éœ€è¦å­¸ç¿’ Promise çš„å»ºæ§‹æ–¹å¼ï¼Œåƒ…éœ€è¦äº†è§£å¦‚ä½•é‹ç”¨å³å¯
            const promiseSetTimeout = (status) => {
              return new Promise((resolve, reject) => {
                setTimeout(() => {
                  if (status) {
                    resolve('promiseSetTimeout æˆåŠŸ')
                  } else {
                    reject('promiseSetTimeout å¤±æ•—')
                  }
                }, 0)
              })
            }

            // #2-1 åŸºç¤é‹ç”¨
            // å› ç‚ºå‚³å…¥trueï¼Œæ‰€ä»¥è¦ç”¨thenä¾†æ¥å—æ”¶ã€‚
            // promiseSetTimeout(true).then((res) => {
            //   console.log('æˆåŠŸå–å¾—è³‡æ–™ã€‚')
            // })

            // #2-2 ä¸²æ¥ï¼šæœ‰é †åºæ€§åœ°å–å¾—è³‡æ–™ã€‚
            // promiseSetTimeout(true)
            //   .then((res) => {
            //     console.log('data01 has already returned')
            //   })
            //   .then((res) => {
            //     console.log('data02 has already returned')
            //   })
            //   .then((res) => {
            //     console.log('data03 has already returned')
            //   })

            // #2-3 å¤±æ•—æ•æ‰
            // å› ç‚ºå‚³å…¥falseï¼Œæ‰€ä»¥è¦ä»¥catchåšå¾ŒçºŒæ•æ‰
            // promiseSetTimeout(false).catch((res) => {
            //   console.log('data transmission failed QAQ.')
            // })

            // #2-4 å…ƒä»¶é‹ç”¨
            const component = {
              data: {},
              init() {
                promiseSetTimeout(true)
                  .then((res) => {
                    console.log('æˆåŠŸæ”¶åˆ°è³‡æ–™ã€‚')
                    //å› ç‚ºæ˜¯arrow functionæ‰€ä»¥thisç¯„åœæ˜¯çˆ¶å±¤functionçš„ç¯„åœï¼Œä¹Ÿå°±æ˜¯èªªæ­£å¸¸çš„å‘¼å«æœƒä½¿this == component
                    this.data.res = res
                    console.log('component.init()çš„dataç‰©ä»¶ : ', this.data)
                  })
                  .catch((err) => {
                    console.log('è³‡æ–™æ”¶å–å¤±æ•—ã€‚')
                    //å› ç‚ºæ˜¯arrow functionæ‰€ä»¥thisç¯„åœæ˜¯çˆ¶å±¤functionçš„ç¯„åœï¼Œä¹Ÿå°±æ˜¯èªªæ­£å¸¸çš„å‘¼å«æœƒä½¿this == component
                    this.data.err = err
                    console.log('component.init()çš„dataç‰©ä»¶ : ', this.data)
                  })

                // initåŸ·è¡Œé †åºï¼š
                // 1. PromiseSetTimeout
                // 2. console.log('component.init()çš„dataç‰©ä»¶ : ', this.data)
              },
            }

            //ç¶²é é–‹å§‹æ™‚å•Ÿå‹•ç”Ÿå‘½é€±æœŸ init()
            component.init()

            // #3 å¯¦æˆ°å–å¾—é ç«¯è³‡æ–™
            // #3-1
            // https://github.com/axios/axios
            axios({
              method: 'get',
              url: 'https://randomuser.me/api/',
            })
              .then((res) => {
                console.log(res.data.results)
              })
              .catch((err) => {
                console.log(err.response.statusText)
              })
            console.log(
              'æˆ‘æœƒåœ¨è³‡æ–™å‚³å›ä¾†å‰åŸ·è¡Œã€‚(ä¸”å› component.init()å±¬æ–¼Promise base codeï¼Œæ‰€ä»¥ä»–ä¹Ÿæœƒåœ¨å¾Œé¢ã€‚)'
            )

            // #3-2 è¨˜å¾—æ•æ‰éŒ¯èª¤ï¼ŒAxios éŒ¯èª¤æ•æ‰æŠ€å·§
            // https://randomuser.me/
          </script>
          <!-- ğŸ™‡ğŸ™‡ç·´ç¿’çµæŸğŸ™‡ğŸ™‡ -->
        </main>

        <aside class="col-md-3">
          <div class="sticky-top" style="top: 76px">
            <div class="list-group">
              <a
                href="/es6/shorthand.html"
                class="list-group-item list-group-item-action"
              >
                ç¸®å¯«
              </a>

              <a
                href="/es6/this.html"
                class="list-group-item list-group-item-action"
              >
                this çš„é‹ä½œ
              </a>

              <a
                href="/es6/arrow_function.html"
                class="list-group-item list-group-item-action"
              >
                ç®­é ­å‡½å¼
              </a>

              <a
                href="/es6/separation_of_concerns.html"
                class="list-group-item list-group-item-action"
              >
                é—œæ³¨é»åˆ†é›¢
              </a>

              <a
                href="/es6/separation_of_concerns_work.html"
                class="list-group-item list-group-item-action"
              >
                é—œæ³¨é»åˆ†é›¢ ç·´ç¿’é¡Œ
              </a>

              <a
                href="/es6/object_reference.html"
                class="list-group-item list-group-item-action"
              >
                ç‰©ä»¶åƒè€ƒç‰¹æ€§
              </a>

              <a
                href="/es6/promise.html"
                class="list-group-item list-group-item-action active"
              >
                Promise
              </a>

              <a
                href="/es6/esModule.html"
                class="list-group-item list-group-item-action"
              >
                ES Module
              </a>

              <a
                href="/es6/esModule_2.html"
                class="list-group-item list-group-item-action"
              >
                ES æ¨¡çµ„å»¶ä¼¸è§€å¿µ
              </a>
            </div>
            <div class="mt-3 text-end p-2 bg-light rounded">
              <small class="text-black-50 fw-light mb-0"
                >æ–‡ä»¶ç‰ˆæœ¬ï¼š2022/11/1</small
              >
            </div>
          </div>
        </aside>
      </div>
    </div>

    <nav class="navbar fixed-top navbar-expand-sm navbar-dark bg-secondary">
      <div class="container-fluid">
        <a class="navbar-brand" href="/">Vue 3 ç·´ç¿’æ‰‹å†Š</a>
        <div class="collapse navbar-collapse" id="navbarCollapse">
          <ul class="navbar-nav">
            <li class="nav-item active">
              <a class="nav-link active" href="/es6/shorthand.html"
                >JS å¿…å‚™è§€å¿µ</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/intro/createApp.html">èªè­˜ Vue.js</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/template/v-text.html">æ¨¡æ¿</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/optionsApi/options-methods.html"
                >æ–¹æ³•</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/components/component_register.html"
                >å…ƒä»¶</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/advApi/adv-refs.html">é€²éš</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/router/vue-router.html">è·¯ç”±</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/composition/proxy.html"
                >Composition API</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/pinia/layout.html">Pinia</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <footer class="footer py-2 bg-light">
      <div class="container text-center">
        <small class="text-black-50 fw-light mb-0"
          >å…­è§’å­¸é™¢ Vue èª²ç¨‹å°ˆå±¬æ–‡ä»¶</small
        >
      </div>
    </footer>
    <link rel="stylesheet" href="/stylesheets/all.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css"
    />
  </body>
</html>
